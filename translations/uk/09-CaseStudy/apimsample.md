<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "2228721599c0c8673de83496b4d7d7a9",
<<<<<<< HEAD
  "translation_date": "2025-08-18T22:45:22+00:00",
=======
  "translation_date": "2025-08-18T18:05:46+00:00",
>>>>>>> origin/main
  "source_file": "09-CaseStudy/apimsample.md",
  "language_code": "uk"
}
-->
# Дослідження: Відкриття REST API в API Management як сервер MCP

Azure API Management — це сервіс, який забезпечує шлюз над вашими API-ендпоінтами. Він працює як проксі перед вашими API і може вирішувати, що робити з вхідними запитами.

Використовуючи його, ви додаєте цілий набір функцій, таких як:

- **Безпека**: можна використовувати все — від API-ключів, JWT до керованої ідентичності.
- **Обмеження швидкості**: чудова функція, яка дозволяє визначити, скільки викликів проходить за певний проміжок часу. Це допомагає забезпечити чудовий досвід для всіх користувачів і запобігти перевантаженню вашого сервісу запитами.
- **Масштабування та балансування навантаження**: можна налаштувати кілька ендпоінтів для розподілу навантаження, а також визначити, як саме здійснювати балансування.
- **AI-функції, такі як семантичне кешування**, обмеження токенів, моніторинг токенів тощо. Це чудові функції, які покращують швидкість відповіді та допомагають контролювати витрати токенів. [Дізнайтеся більше тут](https://learn.microsoft.com/en-us/azure/api-management/genai-gateway-capabilities).

## Чому MCP + Azure API Management?

Model Context Protocol швидко стає стандартом для агентних AI-додатків і способу відкриття інструментів та даних у послідовний спосіб. Azure API Management — це природний вибір, коли потрібно "керувати" API. Сервери MCP часто інтегруються з іншими API для обробки запитів до інструментів, наприклад. Тому поєднання Azure API Management і MCP має багато сенсу.

## Огляд

<<<<<<< HEAD
У цьому конкретному випадку ми навчимося відкривати API-ендпоінти як сервер MCP. Роблячи це, ми можемо легко зробити ці ендпоінти частиною агентного додатка, використовуючи функції Azure API Management.
=======
У цьому конкретному випадку ми навчимося відкривати API-ендпоінти як сервер MCP. Роблячи це, ми можемо легко зробити ці ендпоінти частиною агентного додатку, використовуючи функції Azure API Management.
>>>>>>> origin/main

## Основні функції

- Ви обираєте методи ендпоінтів, які хочете відкрити як інструменти.
- Додаткові функції залежать від того, що ви налаштуєте в розділі політик для вашого API. Але тут ми покажемо, як можна додати обмеження швидкості.

## Попередній крок: імпорт API

Якщо у вас вже є API в Azure API Management — чудово, тоді ви можете пропустити цей крок. Якщо ні, перегляньте це посилання: [імпорт API в Azure API Management](https://learn.microsoft.com/en-us/azure/api-management/import-and-publish#import-and-publish-a-backend-api).

## Відкриття API як сервер MCP

Щоб відкрити API-ендпоінти, виконайте наступні кроки:

1. Перейдіть до Azure Portal за адресою <https://portal.azure.com/?Microsoft_Azure_ApiManagement=mcp>. Перейдіть до вашого екземпляра API Management.

1. У лівому меню виберіть APIs > MCP Servers > + Create new MCP Server.

1. У API виберіть REST API, який потрібно відкрити як сервер MCP.

1. Виберіть одну або кілька операцій API, які потрібно відкрити як інструменти. Ви можете вибрати всі операції або лише конкретні.

    ![Вибір методів для відкриття](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/create-mcp-server-small.png)

1. Натисніть **Create**.

1. Перейдіть до меню **APIs** і **MCP Servers**, ви повинні побачити наступне:

    ![Сервер MCP у головному вікні](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/mcp-server-list.png)

    Сервер MCP створено, і операції API відкриті як інструменти. Сервер MCP відображається у панелі MCP Servers. У колонці URL показано ендпоінт сервера MCP, який можна викликати для тестування або в клієнтському додатку.

## Додатково: Налаштування політик

Azure API Management має основну концепцію політик, де ви встановлюєте різні правила для ваших ендпоінтів, наприклад, обмеження швидкості або семантичне кешування. Ці політики створюються у форматі XML.

Ось як можна налаштувати політику для обмеження швидкості вашого сервера MCP:

1. У порталі, у розділі APIs, виберіть **MCP Servers**.

1. Виберіть сервер MCP, який ви створили.

1. У лівому меню, у розділі MCP, виберіть **Policies**.

<<<<<<< HEAD
1. У редакторі політик додайте або змініть політики, які ви хочете застосувати до інструментів сервера MCP. Політики визначаються у форматі XML. Наприклад, можна додати політику для обмеження викликів до інструментів сервера MCP (у цьому прикладі — 5 викликів за 30 секунд на IP-адресу клієнта). Ось XML, який встановлює обмеження швидкості:
=======
1. У редакторі політик додайте або змініть політики, які ви хочете застосувати до інструментів сервера MCP. Політики визначаються у форматі XML. Наприклад, можна додати політику для обмеження викликів до інструментів сервера MCP (у цьому прикладі — 5 викликів за 30 секунд на IP-адресу клієнта). Ось XML, який викликає обмеження швидкості:
>>>>>>> origin/main

    ```xml
     <rate-limit-by-key calls="5" 
       renewal-period="30" 
       counter-key="@(context.Request.IpAddress)" 
       remaining-calls-variable-name="remainingCallsPerIP" 
    />
    ```

    Ось зображення редактора політик:

    ![Редактор політик](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/mcp-server-policies-small.png)

## Перевірка роботи

Переконаймося, що наш сервер MCP працює належним чином.

<<<<<<< HEAD
Для цього ми використаємо Visual Studio Code і GitHub Copilot у режимі агента. Ми додамо сервер MCP до файлу *mcp.json*. Роблячи це, Visual Studio Code буде діяти як клієнт з агентними можливостями, і кінцеві користувачі зможуть вводити запити та взаємодіяти з сервером.
=======
Для цього ми використаємо Visual Studio Code і GitHub Copilot у режимі агента. Ми додамо сервер MCP до файлу *mcp.json*. Роблячи це, Visual Studio Code буде діяти як клієнт із агентними можливостями, і кінцеві користувачі зможуть вводити запити та взаємодіяти з сервером.
>>>>>>> origin/main

Ось як додати сервер MCP у Visual Studio Code:

1. Використовуйте команду MCP: **Add Server з Command Palette**.

<<<<<<< HEAD
1. Коли буде запропоновано, виберіть тип сервера: **HTTP (HTTP або Server Sent Events)**.

1. Введіть URL сервера MCP в API Management. Наприклад: **https://<apim-service-name>.azure-api.net/<api-name>-mcp/sse** (для ендпоінта SSE) або **https://<apim-service-name>.azure-api.net/<api-name>-mcp/mcp** (для ендпоінта MCP), зверніть увагу на різницю між транспортами `/sse` або `/mcp`.
=======
1. Коли з'явиться запит, виберіть тип сервера: **HTTP (HTTP або Server Sent Events)**.

1. Введіть URL сервера MCP в API Management. Приклад: **https://<apim-service-name>.azure-api.net/<api-name>-mcp/sse** (для ендпоінта SSE) або **https://<apim-service-name>.azure-api.net/<api-name>-mcp/mcp** (для ендпоінта MCP), зверніть увагу на різницю між транспортами `/sse` або `/mcp`.
>>>>>>> origin/main

1. Введіть ідентифікатор сервера на ваш вибір. Це не важливе значення, але воно допоможе вам запам'ятати, що це за екземпляр сервера.

1. Виберіть, чи зберігати конфігурацію у налаштуваннях робочого простору чи користувача.

  - **Налаштування робочого простору** — конфігурація сервера зберігається у файлі .vscode/mcp.json, доступному лише у поточному робочому просторі.

    *mcp.json*

    ```json
    "servers": {
        "APIM petstore" : {
            "type": "sse",
            "url": "url-to-mcp-server/sse"
        }
    }
    ```

    або якщо ви виберете потоковий HTTP як транспорт, це буде трохи інше:

    ```json
    "servers": {
        "APIM petstore" : {
            "type": "http",
            "url": "url-to-mcp-server/mcp"
        }
    }
    ```

  - **Налаштування користувача** — конфігурація сервера додається до вашого глобального файлу *settings.json* і доступна у всіх робочих просторах. Конфігурація виглядає приблизно так:

    ![Налаштування користувача](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/mcp-servers-visual-studio-code.png)

1. Вам також потрібно додати конфігурацію, заголовок для забезпечення автентифікації до Azure API Management. Використовується заголовок **Ocp-Apim-Subscription-Key**.

    - Ось як можна додати його до налаштувань:

    ![Додавання заголовка для автентифікації](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/mcp-server-with-header-visual-studio-code.png), це викличе запит на введення значення API-ключа, яке можна знайти в Azure Portal для вашого екземпляра Azure API Management.

   - Щоб додати його до *mcp.json*, можна зробити це так:

    ```json
    "inputs": [
      {
        "type": "promptString",
        "id": "apim_key",
        "description": "API Key for Azure API Management",
        "password": true
      }
    ]
    "servers": {
        "APIM petstore" : {
            "type": "http",
            "url": "url-to-mcp-server/mcp",
            "headers": {
                "Ocp-Apim-Subscription-Key": "Bearer ${input:apim_key}"
            }
        }
    }
    ```

### Використання режиму агента

Тепер ми налаштували все у налаштуваннях або у *.vscode/mcp.json*. Спробуймо це.

Повинен з'явитися значок інструментів, де відображаються відкриті інструменти з вашого сервера:

![Інструменти з сервера](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/tools-button-visual-studio-code.png)

1. Натисніть значок інструментів, і ви повинні побачити список інструментів, як показано нижче:

    ![Інструменти](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/select-tools-visual-studio-code.png)

1. Введіть запит у чаті, щоб викликати інструмент. Наприклад, якщо ви вибрали інструмент для отримання інформації про замовлення, ви можете запитати агента про замовлення. Ось приклад запиту:

    ```text
    get information from order 2
    ```

<<<<<<< HEAD
    Вам буде показано значок інструментів із запитом продовжити виклик інструменту. Виберіть продовжити виконання інструменту, і ви повинні побачити результат, як показано нижче:

    ![Результат запиту](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/chat-results-visual-studio-code.png)

    **Те, що ви бачите, залежить від налаштованих інструментів, але ідея полягає в тому, що ви отримуєте текстову відповідь, як показано вище.**

## Додаткові матеріали

Ось як можна дізнатися більше:

- [Посібник з Azure API Management і MCP](https://learn.microsoft.com/en-us/azure/api-management/export-rest-mcp-server)
=======
    Тепер вам буде представлено значок інструментів із запитом продовжити виклик інструменту. Виберіть продовжити виконання інструменту, і ви повинні побачити результат, як показано нижче:

    ![Результат запиту](https://learn.microsoft.com/en-us/azure/api-management/media/export-rest-mcp-server/chat-results-visual-studio-code.png)

    **Те, що ви бачите вище, залежить від того, які інструменти ви налаштували, але ідея полягає в тому, що ви отримуєте текстову відповідь, як показано вище.**

## Посилання

Ось як можна дізнатися більше:

- [Підручник з Azure API Management і MCP](https://learn.microsoft.com/en-us/azure/api-management/export-rest-mcp-server)
>>>>>>> origin/main
- [Приклад на Python: Захист віддалених серверів MCP за допомогою Azure API Management (експериментальний)](https://github.com/Azure-Samples/remote-mcp-apim-functions-python)

- [Лабораторія авторизації клієнтів MCP](https://github.com/Azure-Samples/AI-Gateway/tree/main/labs/mcp-client-authorization)

- [Використання розширення Azure API Management для VS Code для імпорту та управління API](https://learn.microsoft.com/en-us/azure/api-management/visual-studio-code-tutorial)

- [Реєстрація та виявлення віддалених серверів MCP в Azure API Center](https://learn.microsoft.com/en-us/azure/api-center/register-discover-mcp-server)
- [AI Gateway](https://github.com/Azure-Samples/AI-Gateway) Чудовий репозиторій, який демонструє багато AI-можливостей з Azure API Management
- [AI Gateway workshops](https://azure-samples.github.io/AI-Gateway/) Містить воркшопи з використанням Azure Portal, що є чудовим способом почати оцінку AI-можливостей.

**Відмова від відповідальності**:  
<<<<<<< HEAD
Цей документ було перекладено за допомогою сервісу автоматичного перекладу [Co-op Translator](https://github.com/Azure/co-op-translator). Хоча ми прагнемо до точності, звертаємо вашу увагу, що автоматичні переклади можуть містити помилки або неточності. Оригінальний документ на його рідній мові слід вважати авторитетним джерелом. Для критично важливої інформації рекомендується професійний людський переклад. Ми не несемо відповідальності за будь-які непорозуміння або неправильні тлумачення, що виникли внаслідок використання цього перекладу.
=======
Цей документ було перекладено за допомогою сервісу автоматичного перекладу [Co-op Translator](https://github.com/Azure/co-op-translator). Хоча ми прагнемо до точності, зверніть увагу, що автоматичні переклади можуть містити помилки або неточності. Оригінальний документ мовою оригіналу слід вважати авторитетним джерелом. Для критично важливої інформації рекомендується професійний людський переклад. Ми не несемо відповідальності за будь-які непорозуміння або неправильні тлумачення, що виникли внаслідок використання цього перекладу.
>>>>>>> origin/main
